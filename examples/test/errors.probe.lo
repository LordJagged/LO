// pointer to error is added to return value
// - real return type is struct { error: &wasi::Err, result: u32 }
// - 0 is placed on the stack when `return` is encountered
// - `throw` puts its value on the stack and fills return values with defaults
// - throwable values must be fittable into `u32`, where 0 would indicate the absence of an error
//   - error codes fit nicely
//   - other errors should be passed by a nullabe pointer
fn fs::open_file(file_path: str): u32 throws wasi::Err {
    // ...

    if err != wasi::Err::SUCCESS { // 0
        throw err;
    };

    return *fd_ref;
};

fn fs::read_file(file_name: str): &String {
    let fd = try fs::open_file(file_name) catch err {
        fputs(wasi::FD_STDERR, "Error opening file: ");
        fputs(wasi::FD_STDERR, file_name);
        fputs(wasi::FD_STDERR, ", error code = ");
        fprint_u32(wasi::FD_STDERR, err);
        fputs(wasi::FD_STDERR, "\n");
        wasi::proc_exit(1);
    };

    // ...
};
